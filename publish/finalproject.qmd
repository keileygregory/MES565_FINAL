---
title: "Humpback whale distributions and insight into preferred oceanographic conditions in the Caribbean using passive acoustic monitoring (PAM) and an autonomous underwater vehicle (AUV)"
author: "Keiley Gregory"
date: today
format:
  html:
    css: style.css
    theme: flatly
    highlight-style: tango
execute:
  working-directory: none
bibliography: references.bib
---

***COMMAND F \* FOR FIXES***

Humpback whale (*Megaptera novaeangliae*)

short background on:

how audio recorded by DMON2 and glider mission path

acoustic analysis in LFDCS and manual verification

raster calculations in arc pro

All quantitative oceanographic variables, including those measured directly by sensors on the glider (water temperature, salinity, dissolved oxygen concentration) and those calculated in ArcGIS Pro (bathymetric depth, bathymetric slope, distance to nearest shoreline), ...

future research - study will use data from more missions in different areas, compare findings between missions, overall patterns, blah blah

# Humpback Whale Distributions

short overview of findings from map (where detections clustered, geomorph type, etc.)

**Fig. 1.** \*WRITE CAPTION

\*link to interactive map

# Oceanographic Conditions

overview of findings for preferred oceanographic conditions

```{r, include=FALSE}
library(tidyverse)
library(ggridges) # for ridge plots
library(patchwork) # optional, for combining plots
library(knitr)
library(kableExtra) # optional but makes it prettier
```

```{r, include=FALSE}
# Import humpback detection data with calculations
hbk <- read_csv("data/GISCALC_HUWH_AroundSTX2025.csv")
```

```{r, include=FALSE}
# Vector of environmental variables to summarize for detections (*EXCLUDE glider depth because not really an environmental variable)
env_vars <- c(
  "Water_temperature_C",
  "Salinity_PSU",
  "Oxygen_concentration_µmol_L",
  "RASTERDEPTH_m",
  "RASTERSLOPE_deg",
  "NEAR_DIST"
  )
```

```{r, include=FALSE}
# Create summary table dataframe
env_summary <- hbk %>%
  select(all_of(env_vars)) %>%
  pivot_longer(
    cols = everything(),
    names_to  = "Variable",
    values_to = "Value"
  ) %>%
  group_by(Variable) %>%
  summarise(
    n     = sum(!is.na(Value)),
    Mean  = mean(Value, na.rm = TRUE),
    SD    = sd(Value, na.rm = TRUE),
    SEM   = SD / sqrt(n),
    Min   = min(Value, na.rm = TRUE),
    Q25   = quantile(Value, 0.25, na.rm = TRUE),
    Median= median(Value, na.rm = TRUE),
    Q75   = quantile(Value, 0.75, na.rm = TRUE),
    Max   = max(Value, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    Variable = case_when(
      Variable == "Water_temperature_C" ~ "Water Temperature (°C)",
      Variable == "Salinity_PSU" ~ "Salinity (PSU)",
      Variable == "Oxygen_concentration_µmol_L" ~ "Dissolved Oxygen Concentration (µmol/L)",
      Variable == "RASTERDEPTH_m" ~ "Bathymetric Depth (m)",
      Variable == "RASTERSLOPE_deg" ~ "Bathymetric Slope (°)",
      Variable == "NEAR_DIST" ~ "Distance to Nearest Shoreline (m)",
      TRUE ~ Variable
    )
  )

# Reorder columns
env_summary <- env_summary %>%
  mutate(
    Variable = factor(
      Variable,
      levels = c(
        "Water Temperature (°C)",
        "Salinity (PSU)",
        "Dissolved Oxygen Concentration (µmol/L)",
        "Bathymetric Depth (m)",
        "Bathymetric Slope (°)",
        "Distance to Nearest Shoreline (m)"
      )
    )
  ) %>%
  arrange(Variable)
```

**Table 1.** \*WRITE CAPTION

```{r, echo=FALSE}
env_summary |>
  kable(format = "html", digits = 2) |>
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

```{r, include=FALSE}
# Create custom color scheme for oceanographic variables
custom_colors <- c(
  Water_temperature_C = "#640191",
  Salinity_PSU = "#1307f7",
  Oxygen_concentration_µmol_L = "#a852ff",
  RASTERDEPTH_m = "#d73dc1",
  RASTERSLOPE_deg = "#cc3c1f",
  NEAR_DIST = "#ffb67a"
)
```

```{r, include=FALSE}
# Create vector of clean variable names
clean_var_names <- c(
  Water_temperature_C = "Water Temperature (°C)",
  Salinity_PSU = "Salinity (PSU)",
  Oxygen_concentration_µmol_L = "Dissolved Oxygen Concentration (µmol/L)",
  RASTERDEPTH_m = "Bathymetric Depth (m)",
  RASTERSLOPE_deg = "Bathymetric Slope (°)",
  NEAR_DIST = "Distance to Nearest Shoreline (m)"
)
```

```{r, include=FALSE}
# Pivot longer to create dataframe for plots
plot_data <- hbk %>%
  select(all_of(env_vars)) %>%
  pivot_longer(
    cols = everything(),
    names_to = "Variable",
    values_to = "Value"
  ) %>%
  mutate(               # set order of variables in plots
    Variable = factor(
      Variable,
      levels = c(
        "Water_temperature_C",
        "Salinity_PSU",
        "Oxygen_concentration_µmol_L",
        "RASTERDEPTH_m",
        "RASTERSLOPE_deg",
        "NEAR_DIST"
      )
    )
  )
```

```{r, echo=FALSE}
# Create multipanel (faceted) box plot
box_plot <- ggplot(plot_data,
                       aes(x = Variable, y = Value, color = Variable, fill  = Variable)) +
  geom_boxplot(alpha = 0.3, width = 0.6, outlier.alpha = 0.6, outlier.size = 1.5) +
  facet_wrap(
    ~ Variable,
    scales = "free",
    ncol   = 3,
    labeller = labeller(Variable = function(x) stringr::str_wrap(clean_var_names[x], width = 18))
  ) +
  scale_color_manual(values = custom_colors) +
  scale_fill_manual(values  = custom_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = "Value"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    strip.text   = element_text(face = "bold"),
    axis.text.x  = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.y = element_text(face = "bold"),
    legend.position = "none"
  )
box_plot
```

**Fig. 2**. \*WRITE CAPTION

```{r, echo=FALSE}
# Create multipanel (faceted) density plot
density_plot <- ggplot(plot_data, 
                           aes(x = Value, color = Variable, fill = Variable)) +
  geom_density(linewidth = 1, alpha = 0.25) +
  facet_wrap(
    ~ Variable,
    scales = "free", ncol = 3,
    labeller = labeller(Variable = function(x) stringr::str_wrap(clean_var_names[x], width = 18))
  ) +
  scale_color_manual(values = custom_colors) +
  scale_fill_manual(values = custom_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = "Density"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    strip.text = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    legend.position = "none"  # hides legend (each facet already labeled)
  )
density_plot
```

**Fig. 3.** \*WRITE CAPTION
